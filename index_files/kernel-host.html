
<!-- saved from url=(0095)https://onboard.triptease.io/kernel/v3976.37119/kernel-host.html?originHost=www.altoatacama.com -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript">//<![CDATA[
!function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function t(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function r(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function n(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))}Object.create;function i(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e){return this instanceof s?(this.v=e,this):new s(e)}function o(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||c(e,t)}))})}function c(e,t){try{(r=i[e](t)).value instanceof s?Promise.resolve(r.value.v).then(u,l):d(o[0][2],r)}catch(e){d(o[0][3],e)}var r}function u(e){c("next",e)}function l(e){c("throw",e)}function d(e,t){e(t),o.shift(),o.length&&c(o[0][0],o[0][1])}}function a(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:s(e[n](t)),done:"return"===n}:i?i(t):t}:i}}function c(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=i(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}}Object.create;var u=function(){var t=this,r={exports:this};function i(e){switch(typeof e){case"undefined":return!0;case"string":return""===e.trim();case"number":return isNaN(e);case"object":if(null==e)return!0;if(e.constructor===Object)return 0===Object.keys(e).length;if(Array.isArray(e))return 0===e.length}return!1}t.__esModule=!0,t.isEmpty=i;t.Strings=class{static noWhitespace(e){return e&&"string"==typeof e?e.replace(/\s+/g,""):""}static startWith(e,t){return e?e.substring(0,t.length)===t:e===t}static endsWith(e,t){return e.substring(e.length-t.length,e.length)===t}static isEmpty(e){return null==e||0===e.trim().length}static isLowerCase(e){return e===e.toLowerCase()&&e!==e.toUpperCase()}static isUpperCase(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}static kebabCase(e){return e.replace(/([A-Z][a-z]+)/g,"$1-").toLowerCase().replace(/-$/,"")}};class s{static keys(e){return Object.keys(e)}static values(e){return Object.keys(e).map((t=>e[t]))}static entries(e){return Object.keys(e).map((t=>[t,e[t]]))}static removeEmpty(e){return e&&e.constructor===Object?Object.keys(e).reduce(((t,r)=>{const n=s.removeEmpty(e[r]);return i(n)||(t[r]=n),t}),{}):e}static sort(e){return e?Array.isArray(e)?e.map(s.sort):e.constructor===Object?Object.keys(e).sort().reduce(((t,r)=>{const n=e[r];return t[r]=s.sort(n),t}),{}):e:e}static toLowerCase(e){return"string"==typeof e?e.toLowerCase():Array.isArray(e)?e.map(s.toLowerCase):a((()=>e.constructor===Object))?Object.entries(e).reduce(((e,[t,r])=>(e[t]=s.toLowerCase(r),e)),{}):e}static omit(e,...t){return t.reduce(((e,t)=>(Reflect.deleteProperty(e,t),e)),e)}static pick(e,...t){return t.reduce(((t,r)=>(t[r]=e[r],t)),{})}}t.Objects=s;t.Maps=class{static entries(e){if(e.entries)return e.entries();const t=[];return e.forEach(((e,r)=>{t.push([r,e])})),t}};class o{static from(e){return Array.from(e)}static find(e,t){if(e.find)return e.find(t);const[r]=e.filter(t);return r}static toObject(e){return e.reduce(((e,t)=>(Object.keys(t).forEach((r=>{r in e||(e[r]=t[r])})),e)),{})}static flatten(e){return e.reduce(((e,t)=>e.concat(t)),[])}static flatMap(e,t){return e.flatMap?e.flatMap(t):o.flatten(e.map(t))}static unique(e){return Array.from(new Set(e))}static clean(e){return e.filter(Boolean)}static trim(e){return e.map((e=>e.trim()))}static includes(e,t){return"includes"in e?e.includes(t):-1!==e.indexOf(t)}static last(e){return e[e.length-1]}static safeReverse(e){return e?e.slice().reverse():[]}}t.Arrays=o;function a(e,t){try{const r=e();return void 0===r?t:r}catch(e){return t}}function c(e,t){const r=t.toLowerCase(),n=o.find(Object.keys(e),(e=>e.toLowerCase()===r));if(!n)return;const i=e[n];return"string"==typeof i?i.trim():i}function u(e,...t){if(!e)return[];if(Array.isArray(e))return o.clean(o.flatten(e.map((e=>u(e,...t)))));if("object"==typeof e){const[r,...n]=t,i=c(e,r);return"object"==typeof i?u(i,...n):0===n.length&&Boolean(i)?[i]:[]}return[]}t.Elements=class{static path(e){let t=[e];for(;e.parentElement;)e=e.parentElement,t.push(e);return t}},t.get=a,t.getAsync=function(e,t){return n(this,void 0,void 0,(function*(){try{const r=yield e();return void 0===r?t:r}catch(e){return t}}))},t.getValue=c,t.getAll=u,t.extract=function(e,t){return o.flatten(t.map((t=>o.clean(o.unique(u(e,...t.split(".")))))))};const l="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:void 0!==r?r:Function("return this")();function d(e,t,r,n=(e=>e)){const i=[];let s,o=0;for(;null!=(s=e.exec(t));)i.push(n(t.substring(o,s.index))),i.push(r(s)),o=e.lastIndex;return i.push(n(t.substring(o))),i.join("")}function h(e){return e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase()}function y(e){return JSON.stringify(s.sort(e))}t.globalThis=l,t.accumulateMultipleValues=function(e,t,r){const n=e[t];return void 0===n?e[t]=r:Array.isArray(n)?-1==n.indexOf(r)&&n.push(r):e[t]=[n,r],e},t.regexReplace=d,t.titleCase=function(e){return d(/\w+/g,e,(e=>h(e[0])))},t.caseWord=h,t.stableJson=y,t.same=function(e,t){return y(e)===y(t)},t.sameIgnoringCase=function(e,t){return y(s.toLowerCase(e))===y(s.toLowerCase(t))},t.limit=function(e,t){return e.slice(0,t)};const f=/\s+/g;return t.cleanSpaces=function(e){return e.trim().replace(f," ")},t.getClassName=function(e){return a((()=>o.last(e.constructor.name.split("$"))),"")},r.exports}.call({});function l(e,t=!0){return e?(0==e.indexOf("?")&&(e=e.substring(1,e.length)),e.split("&").map((function(e){return e.split("=")})).reduce((function(e,r){const n=r[0],i=r[1];if(!n)return e;const s=i?u.get((()=>decodeURIComponent(i.replace(/\+/g,"%20"))),void 0):i,o=t?function(e){try{return JSON.parse(e)}catch(t){return e}}(s):s;return u.accumulateMultipleValues(e,n,o)}),{})):{}}function d(e,t=!0){return Object.keys(u.Objects.removeEmpty(e)).map((r=>{const n=e[r],i=t?function(e){return"string"==typeof e?e:JSON.stringify(e)}(n):n;return`${r}=${encodeURIComponent(i)}`})).join("&")}class h{constructor(e){const t=h.RFC_3986.exec(e);if(!t)throw new Error("Invalid Uri: "+e);const[,,r,,n,i,,s,,o]=t;this.scheme=r,this.authority=n?new y(n):void 0,this.path=i,this.query=s,this.fragment=o}toString(){const e=[];return void 0!==this.scheme&&e.push(this.scheme,":"),void 0!==this.authority&&e.push("//",this.authority.toString()),e.push(this.path),void 0!==this.query&&e.push("?",this.query),void 0!==this.fragment&&e.push("#",this.fragment),e.join("")}get host(){return this.authority&&this.authority.host}get port(){return this.authority&&this.authority.port}get userInfo(){return this.authority&&this.authority.userInfo}}h.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class y{constructor(e){const t=y.RFC_3986.exec(e);if(!t)throw new Error("Invalid Authority: "+e);const[,r,n,i]=t;this.userInfo=r,this.host=n,this.port=i}toString(){const e=[];return void 0!==this.userInfo&&e.push(this.userInfo,"@"),void 0!==this.host&&e.push(this.host),void 0!==this.port&&e.push(":",this.port),e.join("")}}y.RFC_3986=/(?:([^@]+)@)?([^:]+)(?::([\d]+))?/;var f={};Object.defineProperty(f,"__esModule",{value:!0});var p=(g=void 0,f.cache=g);f.caching=p;var g=function(e,t,r){if("function"!=typeof r.value)throw new Error("@cache can only decorate methods");const n=new WeakMap;return Object.defineProperty(e,t,Object.assign(Object.assign({},r),{value:function(...e){const t=JSON.stringify(e),i=function(e){const t=n.get(e);if(t)return t;const r=new Map;return n.set(e,r),r}(this),s=i.get(t);if(void 0!==s)return s;if(i.has(t))return s;const o=r.value.call(this,...e);return i.set(t,o),o}}))};f.cache=g,p=function(e){const t=new Map;return function(...r){const n=JSON.stringify(r),i=t.get(n);if(void 0!==i)return i;if(t.has(n))return i;const s=e(...r);return t.set(n,s),s}},f.caching=p;var v={};Object.defineProperty(v,"__esModule",{value:!0});var m=(b=void 0,I=v.replace=b,v.lazy=I);function w(e,t,r){return Object.defineProperty(e,t,{value:r})}v.container=m;var b=w;function k(e,t,r){if(void 0===r.get)throw new Error("@lazy can only decorate getter methods");return Object.defineProperty(e,t,Object.assign(Object.assign({},r),{get(){return w(this,t,r.get.call(this))[t]}}))}v.replace=b;var S,O,I=k;function T(e=u.globalThis){return e.triptease=e.triptease||{},e.triptease.onboard=e.triptease.onboard||{},{triptease:e.triptease,onboard:e.triptease.onboard}}function j(e,t){return u.get((()=>t.split(".").reduce(((e,t)=>e[t]),e)))}v.lazy=I,m=function(e){return Object.keys(e).reduce(((t,r)=>k(t,r,{configurable:!0,get:()=>e[r](t)})),{})},v.container=m,(O=S||(S={})).Native="native",O.NonNative="non-native",O.NotImplemented="not-implemented";class A{static exposeApi(){const e=T(u.globalThis).triptease;e.native||(e.native=A)}static getProperty(e){const t=j(u.globalThis,e);return(null==(r=t)?S.NotImplemented:"function"==typeof r?r.toString().includes("native code")?S.Native:S.NonNative:S.Native)!==S.NonNative?t:j(A.window,e);var r}static get window(){const e=u.globalThis;try{const t=e.document,r=t.querySelector("[name='triptease.native']");if(r)return r.contentWindow;const n=t.createElement("iframe");return n.style.display="none",n.setAttribute("title","blank"),n.setAttribute("aria-hidden","true"),n.setAttribute("name","triptease.native"),t.documentElement.appendChild(n),n.contentWindow}catch(t){return e}}}t([f.cache,r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Object)],A,"getProperty",null),t([v.lazy,r("design:type",Object),r("design:paramtypes",[])],A,"window",null);const E=A.getProperty("console.log"),x=A.getProperty("console.error"),M=A.getProperty("console.debug");class C{constructor(e=E,t=x,r=M||E){this.log=e,this.error=t,this.debug=r}}class L{constructor(){this.log=()=>{},this.error=()=>{},this.debug=()=>{}}}const P="triptease-debug";function q(e,t="triptease-debug"){const r=u.get((()=>{var r;return l(null===(r=e.location)||void 0===r?void 0:r.search,!1)[t]}))||u.get((()=>{var r;return l(new h(null===(r=e.location)||void 0===r?void 0:r.originalHref).query,!1)[t]}))||u.get((()=>{var t,r;return null===(r=null===(t=e.process)||void 0===t?void 0:t.env)||void 0===r?void 0:r.DEBUG}))||u.get((()=>{var r;return(null===(r=e.localStorage)||void 0===r?void 0:r.getItem)&&e.localStorage.getItem(t)}))||u.get((()=>{var r;return(null===(r=e.sessionStorage)||void 0===r?void 0:r.getItem)&&e.sessionStorage.getItem(t)}))||"";return u.get((()=>r.substring(0,256)),"")}function _(e=u.globalThis){const t=q(e,P);return u.Strings.isEmpty(t)?"":d({[P]:t})}function R(e){const t=e.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp("^"+t+"$")}function N(e,t=u.globalThis){try{const r=function(e){return q(e,P).split(",").map((e=>e.trim()))}(t),n=r.filter((e=>"!"===e[0])).map((e=>e.substr(1)));return n.length>0?!n.some((t=>R(t).test(e))):r.some((t=>"true"===t||R(t).test(e)))}catch(e){return!1}}class F{constructor(e){this.name=e,this.console=new C}debug(e,...t){this.console.debug(`[${this.name}] ${e}`,...t)}log(e,...t){this.console.log(`[${this.name}] ${e}`,...t)}error(e,...t){this.console.error(`[${this.name}] ${e}`,...t)}}function W(e,t=u.globalThis){return N(e,t)?new F(e):new L}var $,D,H,z,B,U,K={};function J(e){return e&&"object"==typeof e&&e.constructor===Object&&"string"==typeof e["@type"]}function V(e,t){return J(e)&&t(e["@type"])}K.isIdentifierSource=function(e){return"object"==typeof e&&"source"in e&&"identifier"in e&&"type"in e},K.isOtherSource=function(e){return"object"==typeof e&&"identifier"in e&&"Other"==e.identifier},K.isStructuredData=J,K.isStructuredDataType=V,K.isLodgingReservation=function(e){return V(e,(e=>"LodgingReservation"===e))},K.isClientSideApplication=function(e){return e&&"object"==typeof e&&"string"==typeof e.name&&"string"==typeof e.type&&"string"==typeof e.url},K.PageType=H,(z=H||($=H={},K.PageType=H,$)).Search="Search",z.RoomsAndRates="RoomsAndRates",z.Confirmation="Confirmation",z.Payment="Payment",z.Group="Group",z.Partial="Partial",z.Unknown="Unknown",K.KernelMode=B,(U=B||(D=B={},K.KernelMode=B,D)).Singleton="Singleton",U.ApplicationHost="ApplicationHost",U.DataSource="DataSource";K.BootstrapName="triptease.onboard.bootstrap";K.KernelHostName="triptease.onboard.kernel-host";const G="triptease.onboard.kernel";var Z,X;K.KernelName=G,K.isScrapedIdentifiers=function(e){return!!e&&("object"==typeof e&&("integrationId"in e||"clientKey"in e||"apiKey"in e||"identifiers"in e||"type"in e))};class Q{constructor(e){this.logger=e,this.workers={}}createWorker(e,t){return n(this,void 0,void 0,(function*(){const r=this.workers[e];return r||(this.workers[e]=yield this.create(t,{name:e}))}))}create(e,t){return n(this,void 0,void 0,(function*(){try{return new Worker(e,t)}catch(r){this.logger.debug("Failed to create Worker switching to Blob Worker because:",r.message);const i=`location.originalHref = "${e}";\n`,s=(yield function(e){return n(this,void 0,void 0,(function*(){if("undefined"!=typeof fetch){const t=yield fetch(e.url,{method:e.method,headers:e.headers,body:e.body,credentials:e.options&&e.options.credentials?"include":"omit"});return{status:t.status,statusDescription:t.statusText,body:yield t.text()}}{const t=new XMLHttpRequest;return t.open(e.method,e.url,!0),e.headers&&Object.keys(e.headers).forEach((r=>{t.setRequestHeader(r,e.headers[r])})),e.options&&e.options.credentials&&(t.withCredentials=!0),t.send(e.body),new Promise(((e,r)=>{t.addEventListener("load",(r=>{e({status:t.status,statusDescription:t.statusText,body:t.responseText})})),t.addEventListener("error",(e=>{r(e)}))}))}}))}({method:"GET",url:e})).body,o=new Blob([i,s],{type:"application/javascript"});return new Worker(URL.createObjectURL(o),t)}}))}}class Y{constructor(e,t=W("application-starter"),r=new Q(t),n=new ee(e,t)){this.window=e,this.logging=t,this.workerFactory=r,this.waiter=n}start(e){return n(this,void 0,void 0,(function*(){this.logging.debug(`ApplicationStarter starting app "${e.name}" (${e.type}), ${e.url}`);const t=this.window.document;if("worker"===e.type){const t=yield this.workerFactory.createWorker(e.name,e.url);return e.startMessage&&(yield this.waiter.waitForMessage(e.startMessage,t)),this.logging.debug("ApplicationStarter returning worker"),t}const r=t.createElement(e.type);r.setAttribute("name",e.name),r.src=e.url;const n=Y.DefaultOptions[e.type]||{};return Object.keys(n).forEach((e=>{r.setAttribute(e.toLowerCase(),n[e])})),this.addElement(r),e.startMessage?yield this.waiter.waitForMessage(e.startMessage):"script"===e.type&&(yield this.waiter.waitForLoadEvent(r)),r}))}addElement(e){(this.window.document.body||this.window.document.documentElement).appendChild(e)}static create(e){var t;const r=T(e).triptease.onboard;return r.applicationStarter=null!==(t=r.applicationStarter)&&void 0!==t?t:new Y(e)}}Y.DefaultOptions={script:{defer:"",async:"",crossOrigin:"anonymous"},iframe:{style:"display: none;",sandbox:"allow-scripts allow-same-origin",title:"blank","aria-hidden":"true"}},t([f.cache,r("design:type",Function),r("design:paramtypes",["function"==typeof(Z=void 0!==K&&K.ClientSideApplication)?Z:Object]),r("design:returntype","function"==typeof(X="undefined"!=typeof Promise&&Promise)?X:Object)],Y.prototype,"start",null);class ee{constructor(e,t){this.window=e,this.logging=t}waitForLoadEvent(e){return this.logging.debug("MessageWaiter waiting for load/error event for",e),new Promise(((t,r)=>{e.addEventListener("load",t),e.addEventListener("error",(()=>r({name:"ScriptError",message:`Failed to load script "${e.src}"`})))}))}waitForMessage(e,t=this.window){return this.logging.debug("MessageWaiter waiting for message",e),new Promise((r=>{this.logging.debug("MessageWaiter creating handler");const n=i=>{try{const s=i.data&&i.data.type,o=s===e;this.logging.debug(`ApplicationStarter message received "${s}", expecting "${e}", matched: ${o}`),o&&(t.removeEventListener("message",n),r(i.data))}catch(e){this.logging.debug("ApplicationStarter error in parsing message",e,i)}};this.logging.debug("MessageWaiter adding listener"),t.addEventListener("message",n)}))}}function te(e,t,r){return function(e,t,r){return Object.defineProperty(e,t,{value:r})}(e,t,r)[t]}function re(e){try{const{target:t,method:r}=ae(e.type);if(t&&r)return!0}catch(e){}return!1}class ne{constructor(e,t=W("worker")){this.worker=e,this.logger=t}addListener(e){this.worker.addEventListener("message",(t=>{re(t.data)&&e(t.data,this)}))}send(e){try{this.worker.postMessage(e)}catch(t){this.worker.postMessage(JSON.parse(JSON.stringify(e)))}}}class ie{constructor(e,t,r=se,n=W("messaging")){this.listener=e,this.target=t,this.allowedOrigins=r,this.logger=n}addListener(e){this.listener&&this.listener.addEventListener("message",(t=>{this.disallowedOrigin(t)||re(t.data)&&e(t.data,new ie(void 0,t.source||this.target))}))}disallowedOrigin(e){return e.origin&&this.allowedOrigins.length>0&&-1===this.allowedOrigins.indexOf(new h(e.origin).host)}send(e){if(this.target)try{this.target.postMessage(e,"*")}catch(t){this.target.postMessage(JSON.parse(JSON.stringify(e)),"*")}}}const se=["onboard.triptease.io","localhost"],oe=/^(.*)\.([^.]+)$/;function ae(e){const[,t,r]=e.match(oe)||[];return{target:t,method:r}}function ce(e,t,r){return{name:e,message:t,stack:null!=r?r:""}}var ue={};Object.defineProperty(ue,"__esModule",{value:!0});var le=(nt=void 0,st=ue.IdentityTransducer=nt,ot=ue.identity=st,ct=ue.transducer=ot,lt=ue.FirstTransducer=ct,ht=ue.first=lt,ft=ue.LastTransducer=ht,gt=ue.last=ft,vt=ue.MapTransducer=gt,wt=ue.map=vt,bt=ue.ZipTransducer=wt,kt=ue.zip=bt,Ot=ue.zipWithIndex=kt,It=ue.FlatMapTransducer=Ot,jt=ue.flatMap=It,Et=ue.FilterTransducer=jt,xt=ue.filter=Et,Mt=ue.reject=xt,Lt=ue.find=Mt,qt=ue.CompositeTransducer=Lt,_t=ue.compose=qt,Nt=ue.decompose=_t,Wt=ue.ScanTransducer=Nt,$t=ue.scan=Wt,Ht=ue.reduce=$t,zt=ue.TakeTransducer=Ht,Ut=ue.take=zt,Kt=ue.DropTransducer=Ut,Vt=ue.drop=Kt,Gt=ue.DropWhileTransducer=Vt,Xt=ue.dropWhile=Gt,Qt=ue.TakeWhileTransducer=Xt,er=ue.takeWhile=Qt,tr=ue.SortTransducer=er,nr=ue.sort=tr,ir=ue.DedupTransducer=nr,or=ue.dedupe=ir,ar=ue.UniqueTransducer=or,cr=ue.unique=ar,ue.windowed=cr);ue.WindowedTransducer=le;var de={};Object.defineProperty(de,"__esModule",{value:!0});var he=(Me=void 0,Ce=de.ascending=Me,Le=de.descending=Ce,Pe=de.comparators=Le,qe=de.key=Pe,Re=de.value=qe,Ne=de.isIterable=Re,Fe=de.isAsyncIterable=Ne,We=de.isPromiseLike=Fe,$e=de.toIterable=We,He=de.iterable=$e,ze=de.isArrayLike=He,Be=de.array=ze,Ue=de.toAsyncIterable=Be,de.by=Ue);de.single=he;var ye={};Object.defineProperty(ye,"__esModule",{value:!0});var fe=(ke=void 0,Se=ye.iterate=ke,Oe=ye.repeat=Se,Te=ye.range=Oe,Ae=ye.sequence=Te,ye.Sequence=Ae);ye.AsyncSequence=fe;var pe={};Object.defineProperty(pe,"__esModule",{value:!0});var ge=(ve=void 0,me=pe.increment=ve,we=pe.add=me,pe.subtract=we);pe.sum=ge;var ve=function(e){return e+1};pe.increment=ve;var me=function(e,t){return void 0===t?t=>e+t:e+t};pe.add=me;var we=function(e,t){return void 0===t?t=>t-e:e-t};function*be(e,t){for(;;)yield t,t=e(t)}pe.subtract=we,ge=(e,t)=>e+t,pe.sum=ge;var ke=be;ye.iterate=ke;var Se=function*(e){for(;;)yield e()};ye.repeat=Se;var Oe=function*(e,t,r=1){if(0===r)throw new Error("step can not be 0");if(void 0===t)yield*be(pe.add(r),e);else{const n=Math.abs(r);t<e?yield*Ie(be(pe.subtract(n),e),ue.takeWhile((e=>e>=t))):yield*Ie(be(pe.add(n),e),ue.takeWhile((e=>e<=t)))}};function Ie(e,...t){return de.isIterable(e)?new je(e,t):de.isArrayLike(e)?new je(de.iterable(e),t):new Ee(e,t)}ye.range=Oe;var Te=Ie;ye.sequence=Te;class je{constructor(e,t){this.source=e,this.transducers=t}[Symbol.iterator](){return this.transducers.reduce(((e,t)=>t.sync(e)),this.source)[Symbol.iterator]()}}var Ae=je;ye.Sequence=Ae;class Ee{constructor(e,t){this.source=e,this.transducers=t}[Symbol.asyncIterator](){return this.transducers.reduce(((e,t)=>t.async_(e)),this.source)[Symbol.asyncIterator]()}}function xe(e,t){return e<t?-1:e>t?1:0}fe=Ee,ye.AsyncSequence=fe;var Me=xe;de.ascending=Me;var Ce=function(e,t){return e<t?1:e>t?-1:0};de.descending=Ce;var Le=function(...e){return(t,r)=>{for(const n of e){const e=n(t,r);if(0!=e)return e}return 0}};de.comparators=Le;var Pe=function(e){return Object.assign((t=>t[e]),{name:e})};de.key=Pe;var qe=function(e){return t=>t[e]};function _e(e){return"object"==typeof e&&Symbol.iterator in e}de.value=qe;var Re=_e;de.isIterable=Re;var Ne=function(e){return"object"==typeof e&&Symbol.asyncIterator in e};de.isAsyncIterable=Ne;var Fe=function(e){return"object"==typeof e&&"then"in e};de.isPromiseLike=Fe;var We=function(...e){return e};de.toIterable=We;var $e=function*(e){for(let t=0;t<e.length;t++)yield e[t]};function De(e){return"object"==typeof e&&"number"==typeof e.length}de.iterable=$e;var He=De;de.isArrayLike=He;var ze=function(e,...t){return _e(e)||De(e)?function(e){const t=[];for(const r of e)t.push(r);return t}(ye.sequence(e,...t)):function(e){var t,r,i,s;return n(this,void 0,void 0,(function*(){const n=[];try{for(t=c(e);!(r=yield t.next()).done;){const e=r.value;n.push(e)}}catch(e){i={error:e}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}return n}))}(ye.sequence(e,...t))};de.array=ze;var Be=function(e){return o(this,arguments,(function*(){yield yield s(e)}))};de.toAsyncIterable=Be;var Ue=function(e,t=xe){return"function"==typeof e?function(e,t=xe){return(r,n)=>t(e(r),e(n))}(e,t):function(e,t=xe){return(r,n)=>t(r[e],n[e])}(e,t)};de.by=Ue,he=function(e,...t){return _e(e)?function(e){for(const t of e)return t;throw new Error("Expected a single value")}(ye.sequence(e,...t)):function(e){var t,r,i,s;return n(this,void 0,void 0,(function*(){try{for(t=c(e);!(r=yield t.next()).done;){return r.value}}catch(e){i={error:e}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}throw new Error("Expected a single value")}))}(ye.sequence(e,...t))},de.single=he;var Ke={};Object.defineProperty(Ke,"__esModule",{value:!0});var Je=void 0;Ke.AVLTree=Je;class Ve{constructor(e){this.comparator=e}static empty(e=de.ascending){return new Ge(e)}static create(e,t,r=de.ascending){const n=Ve.empty(r);return new Ze(r,e,t,n,n)}static of(e,t=de.ascending){return Ve.preSorted(e.sort(de.by(0)),t,Ve.empty(t))}static preSorted(e,t,r){const n=e.length;switch(n){case 0:return r;case 1:{const[[n,i]]=e;return new Ze(t,n,i,r,r)}default:{const i=Math.floor(n/2),s=Ve.preSorted(e.slice(0,i),t,r),o=Ve.preSorted(e.slice(i+1),t,r),[a,c]=e[i];return new Ze(t,a,c,s,o)}}}}Je=Ve,Ke.AVLTree=Je;class Ge extends Ve{constructor(e){super(e),this.isEmpty=!0,this.height=0,this.balance=0}insert(e,t){return new Ze(this.comparator,e,t,this,this)}contains(e){return!1}lookup(e){}delete(e){return{tree:this}}first(){}last(){}removeFirst(){return{tree:this}}removeLast(){return{tree:this}}toString(){return""}*keys(){}*values(){}*entries(){return[]}}class Ze extends Ve{constructor(e,t,r,n,i){super(e),this.key=t,this.value=r,this.left=n,this.right=i,this.isEmpty=!1}insert(e,t){const r=this.comparator(e,this.key);return 0===r?new Ze(this.comparator,e,t,this.left,this.right):r<0?this.replaceLeft(this.left.insert(e,t)):this.replaceRight(this.right.insert(e,t))}contains(e){const t=this.comparator(e,this.key);return 0===t||(t<0?this.left.contains(e):this.right.contains(e))}lookup(e){const t=this.comparator(e,this.key);return 0===t?this.value:t<0?this.left.lookup(e):this.right.lookup(e)}delete(e){const t=this.comparator(e,this.key);if(0===t){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};const{tree:e,key:t,value:r}=this.left.removeLast();return{tree:Xe(new Ze(this.comparator,t,r,e,this.right)),key:this.key,value:this.value}}if(t<0){const{tree:t,key:r,value:n}=this.left.delete(e);return{tree:this.replaceLeft(t),key:r,value:n}}const{tree:r,key:n,value:i}=this.right.delete(e);return{tree:this.replaceRight(r),key:n,value:i}}first(){return this.left.isEmpty?this.value:this.left.first()}last(){return this.right.isEmpty?this.value:this.right.last()}removeFirst(){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};const{tree:e,key:t,value:r}=this.left.removeFirst();return{tree:this.replaceLeft(e),key:t,value:r}}removeLast(){if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};const{tree:e,key:t,value:r}=this.right.removeLast();return{tree:this.replaceRight(e),key:t,value:r}}replaceLeft(e){return Xe(new Ze(this.comparator,this.key,this.value,e,this.right))}replaceRight(e){return Xe(new Ze(this.comparator,this.key,this.value,this.left,e))}toString(){return`(${this.left} ${this.key}=${this.value} ${this.right})`}get balance(){return this.left.height-this.right.height}get height(){return Math.max(this.left.height,this.right.height)+1}*keys(){yield*this.left.keys(),yield this.key,yield*this.right.keys()}*values(){yield*this.left.values(),yield this.value,yield*this.right.values()}*entries(){yield*this.left.entries(),yield[this.key,this.value],yield*this.right.entries()}}function Xe(e){const t=e.balance;return-2==t?function(e){const t=e.right.balance;return 1==t?function(e){const t=tt(e.right);return Ye(e.replaceRight(t))}(e):-1==t?Ye(e):e}(e):2==t?function(e){const t=e.left.balance;return-1==t?function(e){const t=et(e.left);return Qe(e.replaceLeft(t))}(e):1==t?Qe(e):e}(e):e}function Qe(e){return tt(e)}function Ye(e){return et(e)}function et(e){const t=e.right,r=t.left,n=e.replaceRight(r);return t.replaceLeft(n)}function tt(e){const t=e.left,r=t.right,n=e.replaceLeft(r);return t.replaceRight(n)}t([v.lazy],Ze.prototype,"balance",null),t([v.lazy],Ze.prototype,"height",null);class rt{async_(e){return e}sync(e){return e}}var nt=rt;function it(){return new rt}ue.IdentityTransducer=nt;var st=it;ue.identity=st;var ot=it;ue.transducer=ot;class at{async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;return yield s(yield yield s(e))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)return yield t}}var ct=at;function ut(){return new at}ue.FirstTransducer=ct;var lt=ut;ue.first=lt;class dt{async_(e){return o(this,arguments,(function*(){var t,r;let n;try{for(var i,o=c(e);!(i=yield s(o.next())).done;)n=i.value}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}void 0!==n&&(yield yield s(n))}))}*sync(e){let t;for(t of e);void 0!==t&&(yield t)}}var ht=dt;function yt(){return new dt}ue.LastTransducer=ht;var ft=yt;ue.last=ft;class pt{constructor(e){this.mapper=e}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;yield yield s(this.mapper(e))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)yield this.mapper(t)}}var gt=pt;ue.MapTransducer=gt;var vt=function(e){return new pt(e)};ue.map=vt;class mt{constructor(e){this.other=e}async_(e){return o(this,arguments,(function*(){if(!de.isAsyncIterable(this.other))throw new Error("Unsupported operation exception");const t=e[Symbol.asyncIterator](),r=this.other[Symbol.asyncIterator]();for(;;){const[e,n]=yield s(Promise.all([t.next(),r.next()]));if(e.done||n.done)return yield s(void 0);yield yield s([e.value,n.value])}}))}*sync(e){if(!de.isIterable(this.other))throw new Error("Unsupported operation exception");const t=e[Symbol.iterator](),r=this.other[Symbol.iterator]();for(;;){const e=t.next(),n=r.next();if(e.done||n.done)return;yield[e.value,n.value]}}}var wt=mt;ue.ZipTransducer=wt;var bt=function(e){return new mt(e)};ue.zip=bt;var kt=function(){return new mt(ye.range(0))};ue.zipWithIndex=kt;class St{constructor(e){this.mapper=e}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;yield s(yield*a(c(this.mapper(e))))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)yield*this.mapper(t)}}var Ot=St;ue.FlatMapTransducer=Ot;var It=function(e){return new St(e)};ue.flatMap=It;class Tt{constructor(e){this.predicate=e}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;this.predicate(e)&&(yield yield s(e))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)this.predicate(t)&&(yield t)}}var jt=Tt;function At(e){return new Tt(e)}ue.FilterTransducer=jt;var Et=At;ue.filter=Et;var xt=function(e){return new Tt((t=>!e(t)))};ue.reject=xt;var Mt=function(e){return Pt(At(e),ut())};ue.find=Mt;class Ct{constructor(e,t){this.a=e,this.b=t}async_(e){return this.b.async_(this.a.async_(e))}sync(e){return this.b.sync(this.a.sync(e))}}var Lt=Ct;function Pt(e,t){return new Ct(e,t)}ue.CompositeTransducer=Lt;var qt=Pt;ue.compose=qt;var _t=function*e(t){t instanceof Ct?(yield*e(t.a),yield*e(t.b)):yield t};ue.decompose=_t;class Rt{constructor(e,t){this.reducer=e,this.seed=t}async_(e){return o(this,arguments,(function*(){var t,r;let n=this.seed;yield yield s(n);try{for(var i,o=c(e);!(i=yield s(o.next())).done;){const e=i.value;yield yield s(n=this.reducer(n,e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}}))}*sync(e){let t=this.seed;yield t;for(const r of e)yield t=this.reducer(t,r)}}var Nt=Rt;function Ft(e,t){return new Rt(e,t)}ue.ScanTransducer=Nt;var Wt=Ft;ue.scan=Wt;var $t=function(e,t){return Pt(Ft(e,t),yt())};ue.reduce=$t;class Dt{constructor(e){this.count=e}async_(e){return o(this,arguments,(function*(){var t,r;if(this.count<1)return yield s(void 0);try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;if(yield yield s(e),--this.count<1)return yield s(void 0)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){if(!(this.count<1))for(const t of e)if(yield t,--this.count<1)return}}var Ht=Dt;ue.TakeTransducer=Ht;var zt=function(e){return new Dt(e)};ue.take=zt;class Bt{constructor(e){this.count=e}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;--this.count<0&&(yield yield s(e))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)--this.count<0&&(yield t)}}var Ut=Bt;ue.DropTransducer=Ut;var Kt=function(e){return new Bt(e)};ue.drop=Kt;class Jt{constructor(e){this.predicate=e}async_(e){return o(this,arguments,(function*(){var t,r;let n=!0;try{for(var i,o=c(e);!(i=yield s(o.next())).done;){const e=i.value;n&&(n=this.predicate(e)),n||(yield yield s(e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}}))}*sync(e){let t=!0;for(const r of e)t&&(t=this.predicate(r)),t||(yield r)}}var Vt=Jt;ue.DropWhileTransducer=Vt;var Gt=function(e){return new Jt(e)};ue.dropWhile=Gt;class Zt{constructor(e){this.predicate=e}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;if(!this.predicate(e))return yield s(void 0);yield yield s(e)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e){if(!this.predicate(t))return;yield t}}}var Xt=Zt;ue.TakeWhileTransducer=Xt;var Qt=function(e){return new Zt(e)};ue.takeWhile=Qt;class Yt{constructor(e){this.comparator=e}async_(e){return o(this,arguments,(function*(){const t=yield s(de.array(e));t.sort(this.comparator),yield s(yield*a(c(t)))}))}*sync(e){const t=de.array(e);t.sort(this.comparator),yield*t}}var er=Yt;ue.SortTransducer=er;var tr=function(e=de.ascending){return new Yt(e)};ue.sort=tr;class rr{constructor(e){this.comparator=e}async_(e){return o(this,arguments,(function*(){var t,r;let n;try{for(var i,o=c(e);!(i=yield s(o.next())).done;){const e=i.value;(void 0===n||0!==this.comparator(e,n))&&(yield yield s(e)),n=e}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}}))}*sync(e){let t;for(const r of e)(void 0===t||0!==this.comparator(r,t))&&(yield r),t=r}}var nr=rr;ue.DedupTransducer=nr;var ir=function(e=de.ascending){return new rr(e)};ue.dedupe=ir;class sr{constructor(e){this.comparator=e}async_(e){return o(this,arguments,(function*(){var t,r;let n=Ke.AVLTree.empty(this.comparator);try{for(var i,o=c(e);!(i=yield s(o.next())).done;){const e=i.value;n.contains(e)||(n=n.insert(e,void 0),yield yield s(e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}}))}*sync(e){let t=Ke.AVLTree.empty(this.comparator);for(const r of e)t.contains(r)||(t=t.insert(r,void 0),yield r)}}var or=sr;ue.UniqueTransducer=or;var ar=function(e=de.ascending){return new sr(e)};ue.unique=ar;var cr=function(e,t=1,r=!1){return new ur(e,t,r)};ue.windowed=cr;class ur{constructor(e,t,r){this.size=e,this.step=t,this.remainder=r}async_(e){return o(this,arguments,(function*(){var t,r;let n=[],i=0;try{for(var o,a=c(e);!(o=yield s(a.next())).done;){const e=o.value;i>0?i--:(n.push(e),n.length===this.size&&(yield yield s([...n]),n=n.slice(this.step),this.step>this.size&&(i=this.step-this.size)))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&(yield s(r.call(a)))}finally{if(t)throw t.error}}this.remainder&&(yield yield s([...n]))}))}*sync(e){let t=[],r=0;for(const n of e)r>0?r--:(t.push(n),t.length===this.size&&(yield[...t],t=t.slice(this.step),this.step>this.size&&(r=this.step-this.size)));this.remainder&&(yield[...t])}}function lr(e,t){for(t=e="";e++<36;t+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return t}le=ur,ue.WindowedTransducer=le;class dr{static get last(){return Object.assign({},dr.value)}static get(e,t,r,n){const i={clientKey:t,apiKey:n,pageType:e};if(!u.isEmpty(dr.value)&&u.get((()=>{const e=Object.assign({},dr.value);return delete e.pageVisitId,u.same(e,i)})))return dr.value;const s=Object.assign(Object.assign({},i),{clientName:r,pageVisitId:lr()});return dr.value=s}}function hr(e,t=dr.last){const{pageVisitId:r}=t,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["pageVisitId"]);return Object.assign(Object.assign({},e),{context:Object.assign(Object.assign({},n),e.context||{}),pageVisitId:r})}function*yr(e){for(let t=0;t<e.frames.length;t++){const r=e.frames[t];yield r,yield*yr(r)}}function fr(e,t){return de.array(yr(e),ue.filter((e=>u.get((()=>e.name))===t)))}function pr(e){return e===e.top?0:1+pr(e.parent)}function gr(e){const[t]=e.sort(de.by(pr,de.ascending));return t}dr.value={};const vr=[H.Payment,H.Confirmation,H.RoomsAndRates,H.Group,H.Unknown];function mr(e){return vr.indexOf(e.type)}function wr(e){const[t]=(r=e,r.map((e=>u.get((()=>e.triptease.config)))).filter(Boolean)).sort(de.by(mr,de.ascending));var r;return t}function br(e){return fr(e.top,G)}function kr(e,t=br(e)){if(1===t.length)return B.Singleton;return gr(t)===e?B.ApplicationHost:B.DataSource}const Sr="triptease.onboard.request",Or="triptease.onboard.response";function Ir(e){return e&&"object"==typeof e&&"triptease.onboard.request"===e.type&&"string"==typeof e.requestType&&"string"==typeof e.correlationId&&Array.isArray(e.payload)}function Tr(e){return e&&"object"==typeof e&&"triptease.onboard.response"===e.type&&"string"==typeof e.correlationId}function jr(e,t){return{type:"triptease.onboard.response",correlationId:e,payload:t}}function Ar(e,t){return jr(e,ce("NotFound","No handler found for "+t))}const Er=W("messaging");class xr{constructor(){this.handlers=new Map}register(e,t){return e.forEach((e=>{if(this.hasHandlerFor(e))throw new Error(`Method name "${e}" already registered to a handler`);this.handlers.set(e,t)})),this}handle(e){return n(this,void 0,void 0,(function*(){const t=this.handlers.get(e.requestType);return t?(Er.debug("Matched message to handler",e,t),yield t.handle(e)):Ar(e.correlationId,e.requestType)}))}hasHandlerFor(e){return this.handlers.has(e)}}const Mr=W("messaging");class Cr{constructor(e){this.target=e}handle(e){return n(this,void 0,void 0,(function*(){const t=this.target[e.requestType];if(!t)return Mr.debug("No method found that matches method",e.requestType,this.target),Ar(e.correlationId,e.requestType);try{Mr.debug("Found method",e.requestType);const r=yield t.apply(this.target,e.payload);return jr(e.correlationId,r)}catch(t){return Mr.debug("Error trying to in invoke method",e.requestType,t),function(e,t){return jr(e,ce(t.name,t.message,t.stack))}(e.correlationId,t)}}))}}class Lr{generate(e){if(void 0!==e)throw new Error("UuidGenerator does not support custom lengths");return lr().replace(/-/g,"")}}class Pr{constructor(e,t){this.messaging=e,this.idGenerator=t}get(e,t,r){return(...e)=>n(this,void 0,void 0,(function*(){const r=this.idGenerator.generate(),{payload:n}=yield this.messaging.handle({type:"triptease.onboard.request",requestType:String(t),payload:e,correlationId:r});if((i=n)&&"object"==typeof i&&"name"in i&&"string"==typeof i.name&&"message"in i&&"string"==typeof i.message&&"stack"in i&&"string"==typeof i.stack)throw n;var i;return n}))}}function qr(e,t=new Lr){return new Proxy({},new Pr(e,t))}const _r=W("messaging");class Rr{constructor(e){this.messageHandler=e,this.promises=new Map,e&&e.addListener((e=>{if(Tr(e)){const{correlationId:t}=e,r=this.promises.get(t);r&&(_r.debug("Sender matched response",e),r.resolve(e),this.promises.delete(t))}}))}handle(e){return n(this,void 0,void 0,(function*(){return _r.debug("Sending request",e),this.messageHandler&&this.messageHandler.send(e),new Promise(((t,r)=>{this.promises.set(e.correlationId,{resolve:t,reject:r})}))}))}}class Nr{constructor(e,t,r=W("messaging")){this.listen=e,this.router=t,this.logger=r,this.rules=[],e.addListener(this.handler.bind(this)),this.addRule(Ir,(e=>e),(e=>e)),this.addRule(Fr,Wr,$r)}registerAlias(e,t){if(!this.router.hasHandlerFor(t))throw new Error(`Illegal alias: Method "${t}" is not registered with router`);return this.addRule((r=e,e=>e.type===r),function(e){return t=>({type:"triptease.onboard.request",requestType:String(e),payload:[t],correlationId:t.correlationId||"fire-and-forget"})}(t),$r);var r}handler(e,t){return n(this,void 0,void 0,(function*(){if(Tr(e))return;this.logger.debug("listenOn received request",e);const r=this.rules.find((t=>t.predicate(e)));if(!r)return;const n=r.requestConverter(e),i=yield this.router.handle(n);!function(e){return u.get((()=>"NotFound"===e.payload.name),!1)}(i)?e.correlationId&&e.correlationId===i.correlationId&&(this.logger.debug("listenOn sending response to sender",i),t.send(r.responseConverter(i))):this.logger.debug(`Handler not found for request "${n.requestType}", potentially for another listener`)}))}addRule(e,t,r){return this.rules.push({predicate:e,requestConverter:t,responseConverter:r}),this}}function Fr(e){return!Ir(e)&&!!e.correlationId}function Wr(e){const{value:t,correlationId:r}=e,{method:n}=ae(e.type);return{type:"triptease.onboard.request",requestType:n,payload:[t],correlationId:r}}function $r(e){return{type:"triptease.onboard.response",correlationId:e.correlationId,value:e.payload}}var Dr={};Object.defineProperty(Dr,"__esModule",{value:!0});var Hr=(zr=void 0,Dr.SystemClock=zr);Dr.StoppedClock=Hr;var zr=class{now(){return new Date}};Dr.SystemClock=zr;function Br(e){const t=new Error(e);return t.source="ulid",t}Hr=class{constructor(e){this.value=e}now(){return this.value}},Dr.StoppedClock=Hr;const Ur="0123456789ABCDEFGHJKMNPQRSTVWXYZ",Kr=Ur.length,Jr=Math.pow(2,48)-1;function Vr(e){let t=Math.floor(e()*Kr);return t===Kr&&(t=Kr-1),Ur.charAt(t)}const Gr=u.globalThis;A.getProperty("Date");class Zr{now(){return new Date}}function Xr(e){return new Promise((t=>{this.setTimeout((()=>{t()}),e)}))}class Qr{constructor(e=new Zr){this.clock=e,this.delay=Xr.bind(this),this.delay=Xr}task(e){return n(this,void 0,void 0,(function*(){return yield this.delay(0),e()}))}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}setInterval(e,t){return setInterval(e,t)}clearInterval(e){clearInterval(e)}requestIdleCallback(e,t){const r=t?t.timeout:1;let n=this.clock.now().getTime()+r;const i=this;return this.setTimeout((()=>{e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(i.clock.now().getTime()-n))})}),r)}cancelIdleCallback(e){this.clearTimeout(e)}}new Qr;const Yr=W("messaging");class en{constructor(e,t=new BroadcastChannel(Sr),r=new BroadcastChannel(Or)){this.messageHandler=e,this.requests=t,this.responses=r,this.requests.addEventListener("message",(e=>n(this,void 0,void 0,(function*(){const t=e.data;Yr.debug("BroadcastListener received request",t);const r=yield this.messageHandler.handle(t);this.responses.postMessage(r)}))))}}class tn{constructor(e=new Qr,t=new BroadcastChannel(Sr),r=new BroadcastChannel(Or)){this.timers=e,this.requests=t,this.responses=r,this.promises=new Map,this.payloads=new Map,this.responses.addEventListener("message",(e=>{const t=e.data,{correlationId:r}=t;if(this.promises.get(r)){Yr.debug("BroadcastSender received response, storing payload",t);const e=this.payloads.get(r)||[],{payload:n}=t;this.payloads.set(r,e.concat(n))}}))}handle(e){return n(this,void 0,void 0,(function*(){return Yr.debug("Sending request",e),this.requests.postMessage(e),this.timers.delay(50).then((()=>{Yr.debug("BroadcastSender timer fired");const{correlationId:t}=e,r=this.promises.get(t);if(r){const e=this.payloads.get(t)||[],n={correlationId:t,type:Or,payload:e};Yr.debug("BroadcastSender matched response",n),r.resolve(n),this.promises.delete(t),this.payloads.delete(t)}})),new Promise(((t,r)=>{this.promises.set(e.correlationId,{resolve:t,reject:r})}))}))}}const rn="triptease-anonymous-id";class nn{constructor(e){this.storage=e}getAnonymousIds(){return n(this,void 0,void 0,(function*(){const e=this.storage.get(rn);return e?[e]:[]}))}setAnonymousId(e){return n(this,void 0,void 0,(function*(){this.storage.set(rn,e)}))}}class sn{constructor(e,t=qr(new tn)){this.receiver=e,this.sender=t,new en(new Cr(e))}static create(e){return u.get((()=>new sn(e)),e)}getAnonymousIds(){return n(this,void 0,void 0,(function*(){return this.sender.getAnonymousIds()}))}setAnonymousId(e){return this.sender.setAnonymousId(e)}}const on=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}\.\d{3}Z)?$/;function an(e,t,r){if(t(e))return r(e);switch(typeof e){case"undefined":return;case"object":if(null===e)return null;if(Array.isArray(e))return e.map((e=>an(e,t,r)));if(e.constructor===Object)return u.Objects.keys(e).sort().reduce(((n,i)=>{const s=e[i];return n[i]=an(s,t,r),n}),{})}return e}function cn(e){return function(e){return an(e,(e=>"string"==typeof e&&on.test(e)),(e=>{const t=new Date(e);return isNaN(t.valueOf())?e:t}))}(JSON.parse(e))}class un{constructor(e){this.storage=e}get(e){const t=this.storage.getItem(e);if(t)return cn(t)}set(e,t){return this.storage.setItem(e,JSON.stringify(t)),this}clear(){this.storage.clear()}}class ln{constructor(){this.data=new Map}get(e){return this.data.get(e)}set(e,t){return this.data.set(e,t)}clear(){this.data.clear()}}class dn{constructor(e,t,r=sn.create(new nn(u.get((()=>new un(e.localStorage)),new ln))),n=W("kernel"),i=Y.create(e)){this.window=e,this.allowedOrigin=t,this.identityProvider=r,this.logger=n,this.starter=i}get triptease(){const e=this.window.triptease=this.window.triptease||{};return e.onboard={"kernel-host":this},te(this,"triptease",e)}start(){return n(this,void 0,void 0,(function*(){this.logger.debug("KernelHost starting"),this.triptease;const e=new ie(this.window,this.window.parent,[...se,this.allowedOrigin],this.logger),t=yield this.starter.start({name:G,url:"kernel.js?"+_(),type:"worker",startMessage:"triptease.onboard.kernel-started"}),r=new ne(t),n=new Rr(r);this.kernel=qr(n),new Nr(e,this.router=(new xr).register(["getPageState","startApp","applicationConfig","processConfig","getAnonymousIds","setAnonymousId"],new Cr(this)).register(["generateConfig"],n)).registerAlias("triptease.config","processConfig"),new Nr(r,(new xr).register(["trackError","trackMessage"],new Rr(e))),e.send({type:"triptease.onboard.kernel-host-started"}),this.logger.log("KernelHost started")}))}startApp(e){return n(this,void 0,void 0,(function*(){const t=yield this.starter.start(e),r=new Rr(new ne(t));this.router.register(e.requestTypes,r)}))}getAnonymousIds(){return this.identityProvider.getAnonymousIds()}setAnonymousId(e){return n(this,void 0,void 0,(function*(){yield this.identityProvider.setAnonymousId(e)}))}getPageState(){return n(this,void 0,void 0,(function*(){return dr.last}))}applicationConfig(e){return n(this,void 0,void 0,(function*(){return kr(this.window)===B.DataSource?{applications:[]}:this.kernel.applicationConfig(e)}))}processConfig(e){return n(this,void 0,void 0,(function*(){const t=this.window.parent,r=this.window;T(r).triptease.config=e.payload;const n=br(r.top),i=kr(r,n);switch(this.logger.log(`Kernel Host is in ${i} mode`),i){case B.Singleton:return this.logger.log("Broadcasting triptease.config message",e.payload),this.sendTo(hr(e,dr.get(e.payload.type,e.payload.clientKey,e.payload.clientName,e.payload.apiKey)),t);case B.ApplicationHost:const r=function(e,t){const r=wr(e);return hr(Object.assign(Object.assign({},t),{payload:r}),dr.get(r.type,r.clientKey,r.clientName,r.apiKey))}(n,e);return this.logger.log("Broadcasting triptease.config message",r.payload),this.sendTo(r,t);case B.DataSource:const i=gr(n);return this.logger.log("Sending triptease.config message to kernel host in application host mode",e.payload),this.sendTo(e,i)}}))}sendTo(e,t){new ie(void 0,t).send(e)}}n(void 0,void 0,void 0,(function*(){yield new dn(window,l(location.search).originHost).start()}))}();
//]]></script></head><body></body></html>
function ttRetargeting(){var a=window&&window.document||document,u=window.BEE_SERVER_URL||"https://b.triptease.io",r=window.BEE_WINDOW_LOCATION_URL||window.location.href,c=!!function(e){if(r){var t=r.match(new RegExp(e+"=([^&]*)"));return t&&t[1]}return}("tt_rt"),o="",d=[],p=[];function f(e,t,r){if(!a.getElementById(t)){var i=a.createElement(e);i.setAttribute("id",t),i.setAttribute("src",r),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("style","display: none"),"iframe"===e&&(i.setAttribute("title","blank"),i.setAttribute("aria-hidden","true")),a.body.appendChild(i)}}function g(t,e){(e=e||p).forEach(function(e){e.postMessage(t,u)})}function h(t){0<d.filter(function(e){return JSON.stringify(e)===JSON.stringify(t)}).length||(d.push(t),g(t))}function y(e,t,r){var i,n,s,a,c,o=window.localStorage.getItem("tt_bw_id"),d=e.payload,p={currency:d.currency||r.currency,reference:d.reference||r.reservationId,price:d.price||r.totalPrice,checkin:d.checkin,checkout:d.checkout,basePrice:d.basePrice,tripteaseUserId:t.tripteaseUserId,sessionId:e.sessionId};i=t.apiKey,n=p,s=window.localStorage.getItem("tt_bw_id"),a=n.checkin,c=n.checkout,f("img","tt-rt-conv-pixel",u+"/tracking?event=converted&apiKey="+i+"&currency="+n.currency+"&reservationId="+n.reference+"&totalPrice="+n.price+"&checkin="+(a?a.toISOString().split("T")[0]:"")+"&checkout="+(c?c.toISOString().split("T")[0]:"")+"&basePrice="+(n.basePrice||"")+"&platformUserId="+s+"&tripteaseUserId="+n.tripteaseUserId+"&sessionId="+n.sessionId),h({type:"triptease.retargeting.conversion",apiKey:t.apiKey,platformUserId:o,currency:p.currency,reservationId:p.reference,totalPrice:p.price,checkin:p.checkin,checkout:p.checkout,basePrice:p.basePrice,tripteaseUserId:p.tripteaseUserId,sessionId:p.sessionId})}window.addEventListener("message",function(e){if(e.data&&"triptease.config"===e.data.type&&e.data.userId){var t=e.data,r=t.payload,i=window.triptease&&window.triptease.config&&window.triptease.config.reservation,n={tripteaseUserId:t.userId,sessionId:t.sessionId,apiKey:r.apiKey,bucket:function(e){var t,r=0;if(0===e.length)return r.toString();for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return(Math.abs(r)%2).toString()}(t.userId),conversion:"Confirmation"===r.type&&"confirmed"===r.reservationStatus||!!i,searched:"RoomsAndRates"===r.type};JSON.stringify(n)!==JSON.stringify(o)&&(function(e){var t="tt-bee-tracking-tags",r=u+"?apikey="+e.apiKey+"&bucket="+e.bucket+"&conversion="+e.conversion+"&clicked="+c+"&searched="+e.searched+"&tripteaseUserId="+e.tripteaseUserId,i=a.getElementById(t);if(i){if(i.src===r)return;i.parentNode.removeChild(i)}f("iframe",t,r)}(o=n),n.conversion&&y(t,n,i))}if(e.data&&"triptease.retargeting.ready"===e.data.type){var s=e.source||e.data.listener;s&&(p.push(s),d.forEach(function(e){g(e,[s])}))}}),h({type:"triptease.retargeting.page-view"})}ttRetargeting();